<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>55</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      background: #eef2f3; font-family: Arial, sans-serif;
    }
    #createObjectBtn, #startStopBtn {
      padding: 12px 20px; font-size: 16px; cursor: pointer;
      border-radius: 6px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      position: absolute; top: 20px; z-index: 1000;
    }
    #createObjectBtn {
      left: 20px; background: #e67e22; color: #fff;
      border: 3px solid #d35400;
    }
    #startStopBtn {
      left: 150px; background: #27ae60; color: #fff;
      border: 3px solid #1e8449;
    }
    #startStopBtn.stopped {
      background: #c0392b; border-color: #922b21;
    }
    #ground {
      position: absolute; bottom: 0; left: 0; width: 100%; height: 120px;
      background: linear-gradient(90deg,#7f8c8d,#bdc3c7);
      border-top: 3px solid #2c3e50; z-index: 10;
    }
    #simulator {
      position: absolute; top: 0; left: 0;
      width: 100%; height: calc(100% - 120px);
      background: #fff; z-index: 20;
    }
    #followBox {
      position: absolute; width: 60px; height: 60px;
      background: rgba(52,152,219,0.5); border-radius: 6px;
      display: none; z-index: 900; transform: translate(-50%, 0);
    }
    .object {
      position: absolute; width: 60px; height: 60px;
      background: #3498db; border: 2px solid #2c3e50; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; cursor: pointer; user-select: none;
      z-index: 800; color: #fff; font-size: 12px;
    }
    .label-text { font-size: 14px; color: #fff; pointer-events: none; user-select: none; }
    .input-container { display: flex; flex-direction: column; gap: 4px; width: 100%; }
    .input-with-unit { position: relative; width: 100%; }
    .input-with-unit input {
      width: 100%; font-size: 12px; padding-right: 28px; box-sizing: border-box;
    }
    .input-with-unit span {
      position: absolute; right: 4px; top: 50%; transform: translateY(-50%);
      font-size: 10px; color: #555; pointer-events: none;
    }
    .done-btn {
      position: absolute; width: 60px; font-size: 12px; padding: 3px 0;
      border: 1px solid #1e8449; background: #27ae60; color: #fff;
      border-radius: 4px; cursor: pointer; z-index: 1001;
    }
    #alertBox {
      position: fixed; top: -50px; left: 50%; transform: translateX(-50%);
      background: rgba(231,76,60,0.85); color: #fff;
      padding: 12px 24px; border-radius: 6px; font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 2000;
      opacity: 0.85; animation-fill-mode: forwards;
    }
    @keyframes dropDown {
      0% { top: -50px; opacity: 0 }
      50%, 100% { top: 20px; opacity: 1 }
    }
    @keyframes fadeOut {
      from { opacity: 1 } to { opacity: 0 }
    }
    .arrow {
      position: absolute; font-size: 72px; font-weight: bold;
      color: #000; cursor: pointer; user-select: none; z-index: 700;
    }
  </style>
</head>
<body>
  <button id="createObjectBtn">물체 생성</button>
  <button id="startStopBtn">시작</button>
  <div id="simulator"></div>
  <div id="ground"></div>
  <div id="followBox"></div>
  <div id="alertBox" style="display:none;"></div>

  <script>
    const btn = document.getElementById('createObjectBtn');
    const startBtn = document.getElementById('startStopBtn');
    const followBox = document.getElementById('followBox');
    const simulator = document.getElementById('simulator');
    const alertBox = document.getElementById('alertBox');
    let tracking = false, delayPassed = false, moving = false;
    const objects = [];

    btn.addEventListener('click', () => {
      tracking = !tracking;
      delayPassed = false;
      if (tracking) {
        followBox.style.display = 'block';
        btn.textContent = '취소';
        window.addEventListener('mousemove', followMouse);
        setTimeout(() => delayPassed = true, 300);
        window.addEventListener('click', handleClickOnce);
      } else stopTracking();
    });

    startBtn.addEventListener('click', () => {
      moving = !moving;
      startBtn.textContent = moving ? '중지' : '시작';
      startBtn.classList.toggle('stopped', moving);
    });

    function stopTracking() {
      tracking = false; delayPassed = false;
      followBox.style.display = 'none';
      btn.textContent = '물체 생성';
      window.removeEventListener('mousemove', followMouse);
      window.removeEventListener('click', handleClickOnce);
    }

    function followMouse(e) {
      const y = getBoxY();
      followBox.style.left = e.clientX + 'px';
      followBox.style.top = y + 'px';
    }

    function getBoxY() {
      const ground = 120, boxH = 60, offset = -2;
      return window.innerHeight - ground - boxH + offset;
    }

    function showAlert(msg) {
      alertBox.textContent = msg;
      alertBox.style.display = 'block';
      alertBox.style.animation = 'dropDown 0.5s forwards';
      setTimeout(() => alertBox.style.animation = 'fadeOut 0.5s forwards', 2500);
      alertBox.addEventListener('animationend', () => {
        if (alertBox.style.opacity === '0') {
          alertBox.style.display = 'none'; alertBox.style.animation = '';
        }
      }, { once: true });
    }

    function handleClickOnce(e) {
      if (!delayPassed) return;
      const box = document.createElement('div');
      box.className = 'object';
      const x = e.clientX - 30, y = getBoxY();
      box.style.left = x + 'px'; box.style.top = y + 'px';
      simulator.append(box);

      const arrow = document.createElement('div');
      arrow.className = 'arrow';
      arrow.textContent = '→';
      simulator.appendChild(arrow);

      const obj = { box, arrow, mass: '', velocity: '', dir: '→', x, y, vx: 0 };
      objects.push(obj);
      updateArrow(obj);
      stopTracking();

      function createDoneBtn() {
        const b = document.createElement('button');
        b.className = 'done-btn';
        b.textContent = '완료';
        b.style.left = x + 'px';
        b.style.top = (y - 30) + 'px';
        simulator.appendChild(b);
        return b;
      }

      function makeInputs(m, v) {
        const cont = document.createElement('div'); cont.className = 'input-container';
        [['질량','kg',m],['속도','m/s',v]].forEach(([ph, unit, val]) => {
          const row = document.createElement('div'); row.className = 'input-with-unit';
          const inp = document.createElement('input'); inp.type = 'number'; inp.placeholder = ph; inp.value = val || '';
          const span = document.createElement('span'); span.textContent = unit;
          row.append(inp, span); cont.appendChild(row);
        });
        return {
          cont,
          massInput: cont.children[0].querySelector('input'),
          velInput: cont.children[1].querySelector('input')
        };
      }

      let { cont, massInput, velInput } = makeInputs(obj.mass, obj.velocity);
      box.appendChild(cont);
      let doneBtn = createDoneBtn();

      arrow.addEventListener('click', ev => {
        ev.stopPropagation();
        obj.dir = obj.dir === '→' ? '←' : '→';
        arrow.textContent = obj.dir;
        updateArrow(obj);
      });

      function applyInputs() {
        const m = massInput.value.trim();
        const v = velInput.value.trim();
        if (m === '') { showAlert('질량을 입력해 주세요'); return false; }
        if (v === '') { showAlert('속도를 입력해 주세요'); return false; }
        obj.mass = parseFloat(m);
        obj.velocity = parseFloat(v);
        obj.vx = (obj.dir === '→' ? 1 : -1) * obj.velocity;
        const lbl = box.querySelector('.label-text') || document.createElement('div');
        lbl.className = 'label-text';
        lbl.textContent = `${m} kg`;
        if (!box.contains(lbl)) box.appendChild(lbl);
        cont.remove(); doneBtn.remove();
        return true;
      }

      doneBtn.onclick = () => { applyInputs(); };

      box.addEventListener('click', ev => {
        ev.stopPropagation();
        if (box.querySelector('.input-container')) return;
        const inputs = makeInputs(obj.mass, obj.velocity);
        cont = inputs.cont; massInput = inputs.massInput; velInput = inputs.velInput;
        box.appendChild(cont);
        doneBtn = createDoneBtn();
        doneBtn.onclick = () => { applyInputs(); };
      });
    }

    function updateArrow(obj) {
      const gap = -10;
      const arrow = obj.arrow;
      const box = obj.box;
      const boxX = parseFloat(box.style.left);
      const boxY = parseFloat(box.style.top);
      const boxW = 60;
      const rect = arrow.getBoundingClientRect();
      arrow.style.left = obj.dir === '→' ? (boxX + boxW + gap) + 'px' : (boxX - rect.width - gap) + 'px';
      arrow.style.top = (boxY + (boxW - rect.height) / 2) + 'px';
    }

    function animate() {
      if (moving) {
        for (let obj of objects) {
          const box = obj.box;
          let x = parseFloat(box.style.left);
          x += obj.vx;

          if (x <= 10) { x = 10; obj.vx = 0; obj.dir = '→'; obj.arrow.textContent = '→'; }
          if (x + 60 >= window.innerWidth - 10) {
            x = window.innerWidth - 70;
            obj.vx = 0;
            obj.dir = '←';
            obj.arrow.textContent = '←';
          }

          box.style.left = x + 'px';
          updateArrow(obj);
        }
      }
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
  </script>
</body>
</html>
