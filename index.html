<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>test31</title>
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#eef2f3; font-family:Arial,sans-serif; }
    #createObjectBtn {
      position:absolute; top:20px; left:20px;
      padding:12px 20px; background:#e67e22; color:#fff;
      border:3px solid #d35400; border-radius:6px;
      font-size:16px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.3);
      z-index:1000;
    }
    #ground {
      position:absolute; bottom:0; left:0;
      width:100%; height:120px;
      background:linear-gradient(90deg,#7f8c8d,#bdc3c7);
      border-top:3px solid #2c3e50; z-index:10;
    }
    #simulator {
      position:absolute; top:0; left:0;
      width:100%; height:calc(100% - 120px);
      background:#fff; z-index:20;
    }
    #followBox {
      position:absolute; width:60px; height:60px;
      background:rgba(52,152,219,0.5); border-radius:6px;
      display:none; z-index:900; transform:translate(-50%,0);
    }
    .object {
      position:absolute; width:60px; height:60px;
      background:#3498db; border:2px solid #2c3e50; border-radius:6px;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column; cursor:pointer; user-select:none;
      z-index:800; color:#fff; font-size:12px;
    }
    .label-text { font-size:14px; color:#fff; pointer-events:none; user-select:none; }
    .input-container { display:flex; flex-direction:column; gap:4px; width:100%; }
    .input-with-unit { position:relative; width:100%; }
    .input-with-unit input {
      width:100%; font-size:12px; padding-right:28px; box-sizing:border-box;
    }
    .input-with-unit span {
      position:absolute; right:4px; top:50%; transform:translateY(-50%);
      font-size:10px; color:#555; pointer-events:none;
    }
    .done-btn {
      position:absolute; width:60px; font-size:12px; padding:3px 0;
      border:1px solid #1e8449; background:#27ae60; color:#fff;
      border-radius:4px; cursor:pointer; z-index:1001;
    }
    #alertBox {
      position:fixed; top:-50px; left:50%; transform:translateX(-50%);
      background:rgba(231,76,60,0.85); color:#fff;
      padding:12px 24px; border-radius:6px; font-weight:bold;
      box-shadow:0 2px 6px rgba(0,0,0,0.3); z-index:2000;
      opacity:0.85; animation-fill-mode:forwards;
    }
    @keyframes dropDown {
      0% { top:-50px; opacity:0 }
      50%,100% { top:20px; opacity:1 }
    }
    @keyframes fadeOut {
      from { opacity:1 } to { opacity:0 }
    }
    .arrow {
      position:absolute; font-size:72px; font-weight:bold; color:#000;
      cursor:pointer; user-select:none; z-index:700;
    }
  </style>
</head>
<body>
  <button id="createObjectBtn">물체 생성</button>
  <div id="simulator"></div>
  <div id="ground"></div>
  <div id="followBox"></div>
  <div id="alertBox" style="display:none;"></div>

  <script>
    const btn = document.getElementById('createObjectBtn');
    const followBox = document.getElementById('followBox');
    const simulator = document.getElementById('simulator');
    const alertBox = document.getElementById('alertBox');
    let tracking = false, delayPassed = false;
    const objectData = new Map();

    btn.addEventListener('click', () => {
      tracking = !tracking; delayPassed = false;
      if (tracking) {
        followBox.style.display = 'block';
        btn.textContent = '취소';
        window.addEventListener('mousemove', followMouse);
        setTimeout(() => delayPassed = true, 300);
        window.addEventListener('click', handleClickOnce);
      } else stopTracking();
    });

    function stopTracking() {
      tracking = false; delayPassed = false;
      followBox.style.display = 'none';
      btn.textContent = '물체 생성';
      window.removeEventListener('mousemove', followMouse);
      window.removeEventListener('click', handleClickOnce);
    }

    function followMouse(e) {
      const y = getBoxY();
      followBox.style.left = e.clientX + 'px';
      followBox.style.top = y + 'px';
    }

    function getBoxY() {
      const ground = 120, boxH = 60, offset = -2;
      return window.innerHeight - ground - boxH + offset;
    }

    function showAlert(msg) {
      alertBox.textContent = '질량과 속도를 입력해 주세요';
      alertBox.style.display = 'block';
      alertBox.style.animation = 'dropDown 0.5s forwards';
      setTimeout(() => alertBox.style.animation = 'fadeOut 0.5s forwards', 2500);
      alertBox.addEventListener('animationend', () => {
        if (alertBox.style.opacity==='0') {
          alertBox.style.display = 'none'; alertBox.style.animation = '';
        }
      }, { once:true });
    }

    function handleClickOnce(e) {
      if (!delayPassed) return;

      const box = document.createElement('div');
      box.className = 'object';
      const x = e.clientX - 30, y = getBoxY();
      box.style.left = x + 'px'; box.style.top = y + 'px';
      objectData.set(box, { mass:'', velocity:'', dir:'→' });

      // 완료 버튼
      const doneBtn = document.createElement('button');
      doneBtn.className = 'done-btn'; doneBtn.textContent='완료';
      function updDone(){ doneBtn.style.left=x+'px'; doneBtn.style.top=(y-30)+'px';}
      updDone(); simulator.appendChild(doneBtn);

      // 입력창
      function makeInputs(m,v){
        const cont = document.createElement('div');
        cont.className='input-container';
        ['질량','속도'].forEach((label,i)=>{
          const row=document.createElement('div');
          row.className='input-with-unit';
          const inp=document.createElement('input');
          inp.type='number'; inp.placeholder=label; inp.value = i===0?m:v;
          const unit=document.createElement('span');
          unit.textContent = i===0?'kg':'m/s';
          row.append(inp,unit); cont.appendChild(row);
        });
        return {cont,massInput:cont.children[0].querySelector('input'), velInput:cont.children[1].querySelector('input')};
      }
      let {cont:ic, massInput, velInput} = makeInputs('','');
      box.appendChild(ic);

      // 화살표
      const arrow = document.createElement('div');
      arrow.className='arrow'; arrow.textContent='→';
      simulator.appendChild(arrow);

      function updateArrow(){
        const rect = arrow.getBoundingClientRect();
        const gap=10, boxW=60, boxH=60;
        if(arrow.textContent==='→'){
          arrow.style.left = (x + boxW + gap) + 'px';
        } else {
          arrow.style.left = (x - rect.width - gap) + 'px';
        }
        arrow.style.top = (y + (boxH - rect.height)/2) + 'px';
      }
      updateArrow();

      arrow.addEventListener('click', ev=>{
        ev.stopPropagation();
        arrow.textContent = arrow.textContent==='→'?'←':'→';
        updateArrow();
      });

      doneBtn.addEventListener('click', ()=>{
        const m=massInput.value.trim(), v=velInput.value.trim();
        if(!m && !v){ showAlert(); return; }
        objectData.set(box, {mass:m,velocity:v,dir:arrow.textContent});
        ic.remove(); doneBtn.remove();
        let lbl=box.querySelector('.label-text');
        if(!lbl){ lbl=document.createElement('div'); lbl.className='label-text'; box.appendChild(lbl);}
        lbl.textContent = m?`${m} kg`:'';
      });

      box.addEventListener('click', ev=>{
        ev.stopPropagation();
        if(box.querySelector('.input-container')) return;
        const saved = objectData.get(box);
        let {cont:newIc, massInput:newM, velInput:newV} = makeInputs(saved.mass, saved.velocity);
        box.appendChild(newIc);
        simulator.appendChild(doneBtn);
        updateArrow();
        arrow.style.display='none';
      });

      simulator.appendChild(box);
      stopTracking();
    }
  </script>
</body>
</html>
